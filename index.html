<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœÂ·í™˜ê²½ ì¸í„°ë™í‹°ë¸Œ â€” í’€ì˜µì…˜</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --glass: rgba(255,255,255,0.55);
    --accent: #2f855a;
    --soft: #68d391;
    font-size:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Gowun Dodum',sans-serif;
    color:#0f172a;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    transition:background 1.5s ease;
    background:linear-gradient(180deg,#dff7e6,#bfeccb);
    overflow-y:auto;
  }

  header{
    position:sticky; top:0; z-index:30;
    backdrop-filter: blur(8px);
    background: linear-gradient(90deg,var(--glass), rgba(255,255,255,0.25));
    padding:12px 16px;
    display:flex;
    gap:12px;
    align-items:center;
    border-bottom: 1px solid rgba(0,0,0,0.05);
  }
  .brand {display:flex;flex-direction:column}
  h1{font-size:1.15rem;margin:0;color:var(--accent)}
  .subtitle{font-size:.78rem;color:#22543d;opacity:.9}

  main{
    max-width:1100px;
    margin:18px auto;
    padding:12px;
    display:grid;
    grid-template-columns: 1fr;
    gap:16px;
  }

  /* responsive: two columns on wide screens */
  @media(min-width:900px){
    main{grid-template-columns: 1fr 420px;}
  }

  section{
    background: linear-gradient(180deg,rgba(255,255,255,0.8), rgba(255,255,255,0.7));
    border-radius:14px;
    padding:14px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.06);
    overflow:hidden;
  }

  .sim-canvas{
    width:100%;
    height:260px;
    border-radius:10px;
    display:block;
    touch-action:manipulation;
    background: linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0.05));
  }

  .controls {display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .btn {padding:8px 12px; border-radius:10px; border:none; cursor:pointer; background:var(--accent); color:white; font-weight:600}
  .btn.secondary {background:#3182ce}
  .muted {background:transparent;border:1px solid rgba(0,0,0,0.06); color:#082032;padding:8px 10px;border-radius:10px}

  .small {font-size:.9rem}
  label{display:block;font-size:.9rem;margin-bottom:6px;color:#0f172a}
  input[type="range"]{width:100%}
  textarea{width:100%;height:88px;border-radius:10px;padding:10px;border:1px solid rgba(0,0,0,0.06);resize:vertical}

  .stat{display:flex;align-items:center;gap:8px}
  .stat strong{font-size:1.05rem;color:var(--accent)}

  footer{padding:18px;text-align:center;color:#22543d;opacity:.9}

  /* tiny helper */
  .hint{font-size:.82rem;color:#234e3a;opacity:.9}
</style>
</head>
<body>

<header>
  <div class="brand">
    <h1>ğŸŒ¿ ìƒíƒœÂ·í™˜ê²½ ì¸í„°ë™í‹°ë¸Œ (í’€ì˜µì…˜)</h1>
    <div class="subtitle">ì‹œë®¬ë ˆì´ì…˜ Â· ì‹¤ì‹œê°„ ë‚ ì”¨ Â· ìì—°ìŒ Â· íƒ„ì†Œë°œìêµ­ ê³„ì‚°ê¸°</div>
  </div>

  <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
    <button class="btn" id="soundToggle">ìì—°ìŒ ì¼œê¸°</button>
    <button class="btn secondary" id="resetApp">ì´ˆê¸°í™”</button>
  </div>
</header>

<main>
  <!-- Left column: interactive sections -->
  <div style="display:grid;gap:16px">
    <!-- Simulation -->
    <section>
      <h2>ğŸŒ± ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜</h2>
      <div class="hint">í™”ë©´(ë˜ëŠ” íƒ­)ì„ í„°ì¹˜í•˜ë©´ ìƒëª…ì²´ê°€ íƒœì–´ë‚©ë‹ˆë‹¤. ê¸¸ê²Œ ëˆ„ë¥´ë©´ 'ë‚˜ë¬´'ê°€ ìë¼ìš”.</div>
      <canvas id="simCanvas" class="sim-canvas"></canvas>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="clearSim">ì¥ë©´ ì´ˆê¸°í™”</button>
        <button class="muted" id="toggleTrails">íŠ¸ë ˆì¼ í† ê¸€</button>
        <div style="margin-left:auto" class="stat"><span class="hint">ìƒëª…ì²´ ìˆ˜</span><strong id="creCount">0</strong></div>
      </div>
    </section>

    <!-- Weather & dynamic background -->
    <section>
      <h2>â˜ï¸ ì‹¤ì‹œê°„ ë‚ ì”¨ & ë°°ê²½ ìë™ ì „í™˜</h2>
      <div class="hint">ìœ„ì¹˜ ì ‘ê·¼ í—ˆìš© ì‹œ í˜„ì¬ ê¸°ì˜¨ì„ ê°€ì ¸ì™€ ë°°ê²½ê³¼ ë¶„ìœ„ê¸°ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.</div>
      <div id="weatherBlock" style="margin-top:10px">
        <div id="weatherStatus">ìœ„ì¹˜/ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
        <div id="weatherDetail" style="margin-top:10px"></div>
      </div>
      <div style="margin-top:12px">
        <label>ë‚ ì”¨ ê¸°ë°˜ ë°°ê²½ ê°•ë„</label>
        <input id="bgIntensity" type="range" min="0" max="1" step="0.05" value="0.8">
      </div>
    </section>

    <!-- Carbon calculator -->
    <section>
      <h2>âš–ï¸ íƒ„ì†Œë°œìêµ­ ê³„ì‚°ê¸° (ì˜ˆìƒê°’)</h2>
      <div class="hint">ë§¤ë…„ ë°°ì¶œë˜ëŠ” COâ‚‚e(kg) ì˜ˆì¸¡ â€” ê°„ë‹¨í•œ ê³„ìˆ˜ ê¸°ë°˜ ê³„ì‚°(ì‚°ì¶œì€ ì˜ˆì‹œìš©)</div>

      <div style="display:grid;gap:8px;margin-top:10px">
        <div>
          <label>ì›”ê°„ ì „ê¸° ì‚¬ìš©ëŸ‰ (kWh)</label>
          <input id="inpElectric" type="range" min="0" max="1000" step="1" value="200">
          <div class="small hint">ê°’: <span id="valElectric">200</span> kWh</div>
        </div>

        <div>
          <label>ì£¼ê°„ ìë™ì°¨ ì£¼í–‰ (km)</label>
          <input id="inpCar" type="range" min="0" max="5000" step="10" value="200">
          <div class="small hint">ê°’: <span id="valCar">200</span> km / week</div>
        </div>

        <div>
          <label>ì‹ë‹¨: <select id="dietSelect" style="padding:6px;border-radius:8px">
            <option value="0.9">ê³ ê¸° ì¤‘ì‹¬</option>
            <option value="0.6" selected>í˜¼í•©ì‹</option>
            <option value="0.4">ì‹ë¬¼ ì¤‘ì‹¬</option>
          </select></label>
          <div class="small hint">ê³„ìˆ˜ëŠ” ì‹ë‹¨ì— ë”°ë¥¸ ì—°ê°„ ë°°ì¶œ ê°€ì¤‘ì¹˜(ì˜ˆì‹œ)</div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="calcCarbon">ê³„ì‚°í•˜ê¸°</button>
          <button class="muted" id="saveCarbon">ì €ì¥</button>
          <div style="margin-left:auto" class="stat"><span class="hint">ìµœê·¼ ê³„ì‚°</span><strong id="lastCarbon">â€”</strong></div>
        </div>

        <canvas id="carbonChart" style="height:200px;margin-top:8px"></canvas>
      </div>
    </section>
  </div>

  <!-- Right column: info, quotes, small widgets -->
  <div style="display:grid;gap:16px">
    <section>
      <h2>ğŸ“Š ê¸°í›„ íŠ¸ë Œë“œ (ìƒ˜í”Œ ë°ì´í„°)</h2>
      <canvas id="trendChart" style="height:200px"></canvas>
      <div class="hint" style="margin-top:8px">ì‹œë®¬ë ˆì´ì…˜ìš© í‰ê·  ê¸°ì˜¨ ê·¸ë˜í”„ (2000â€“2025)</div>
    </section>

    <section>
      <h2>ğŸ”Š ìì—°ìŒ ì»¨íŠ¸ë¡¤</h2>
      <div class="hint">ì›¹ì˜¤ë””ì˜¤ë¡œ ìƒì„±í•œ ë¹„/ìƒˆ ì†Œë¦¬ â€” ë°ì´í„° ì‚¬ìš© x</div>
      <div style="margin-top:10px;display:grid;gap:8px">
        <label>ë¹„ ì„¸ê¸° <input id="rainLevel" type="range" min="0" max="1" step="0.01" value="0.3"></label>
        <label>ìƒˆì†Œë¦¬ ë°€ë„ <input id="birdLevel" type="range" min="0" max="1" step="0.01" value="0.4"></label>
        <label>ì „ì²´ ë³¼ë¥¨ <input id="masterVol" type="range" min="0" max="1" step="0.01" value="0.6"></label>
      </div>
    </section>

    <section>
      <h2>ğŸ’¬ ìƒíƒœ ëª…ì–¸</h2>
      <div id="quoteBlock" style="font-style:italic;color:#1b3b2c">"ìì—°ì€ ìš°ë¦¬ê°€ ë¹Œë ¤ ì“°ëŠ” ì§‘ì´ë‹¤."</div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" id="newQuote">ëª…ì–¸ ë°”ê¾¸ê¸°</button>
        <button class="muted" id="shareSnapshot">ìŠ¤ëƒ…ìƒ· ì €ì¥</button>
      </div>
    </section>
  </div>
</main>

<footer>Â© 2025 ìƒíƒœÂ·í™˜ê²½ ì¸í„°ë™í‹°ë¸Œ â€” Designed by ChatGPT Â· ë¡œì»¬ ì‹¤í–‰ ê°€ëŠ¥</footer>

<!-- --- SCRIPTS --- -->
<script>
/* -----------------------------
   Utilities & State
   ----------------------------- */
const state = {
  creatures: [],
  trails: true,
  simRunning: true,
  audioOn: false,
  audioNodes: null,
  lastCarbonKg: null,
  weather: null
};

const q = sel => document.querySelector(sel);
const qa = sel => document.querySelectorAll(sel);

/* -----------------------------
   Simulation: particles + trees
   - click: spawn creature
   - long-press: plant tree
   ----------------------------- */
const simCanvas = q('#simCanvas');
const sctx = simCanvas.getContext('2d');
let simW=0, simH=0;
function resizeSim(){ simW = simCanvas.width = simCanvas.clientWidth; simH = simCanvas.height = simCanvas.clientHeight; }
resizeSim();
window.addEventListener('resize', resizeSim);

let longPressTimer = null;
let isTouching=false;
simCanvas.addEventListener('pointerdown', e=>{
  isTouching=true;
  const rect=simCanvas.getBoundingClientRect();
  const x = e.clientX - rect.left, y = e.clientY - rect.top;
  longPressTimer = setTimeout(()=>{
    // plant tree (larger, static)
    state.creatures.push({x,y,size:18,type:'tree',age:0,color:'#276749'});
    updateCount();
  }, 500);
});
simCanvas.addEventListener('pointerup', e=>{
  isTouching=false;
  if(longPressTimer){ // short tap spawns creature if timer not fired
    clearTimeout(longPressTimer); longPressTimer = null;
    const rect=simCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    spawnCreature(x,y);
  }
});
simCanvas.addEventListener('pointerleave', ()=>{ if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null;} });

function spawnCreature(x,y){
  const c = {
    x, y,
    vx:(Math.random()-0.5)*2,
    vy:(Math.random()-0.6)*1.2,
    size: Math.random()*4+3,
    color: `hsl(${Math.random()*90+80}, 60%, ${45+Math.random()*20}%)`,
    life: 0,
    type:'creature'
  };
  state.creatures.push(c);
  updateCount();
}

/* draw loop */
function simTick(){
  if(!state.trails){
    sctx.clearRect(0,0,simW,simH);
  } else {
    // semi-transparent overlay for soft trails
    sctx.fillStyle = 'rgba(255,255,255,0.08)';
    sctx.fillRect(0,0,simW,simH);
  }

  for(let i=state.creatures.length-1;i>=0;i--){
    const c = state.creatures[i];
    if(c.type === 'tree'){
      // tree grows slowly
      c.age += 0.02;
      sctx.beginPath();
      sctx.fillStyle = c.color;
      sctx.arc(c.x, c.y - c.age*2, c.size + c.age*4, 0, Math.PI*2);
      sctx.fill();
      sctx.fillStyle = '#6b4226';
      sctx.fillRect(c.x - (4 + c.age*0.6), c.y + 6, 6 + c.age*1.2, 8);
      if(c.age > 30) state.creatures.splice(i,1); // decay very old tree (keeps sim light)
    } else {
      c.life += 1;
      c.vy += 0.02; // gravity
      c.x += c.vx; c.y += c.vy;
      // simple edge bounce
      if(c.x < 0 || c.x > simW) c.vx *= -0.9;
      if(c.y > simH) { c.y = simH; c.vy *= -.6; c.vx *= .98; }
      // draw
      sctx.beginPath();
      const g = sctx.createRadialGradient(c.x, c.y, 0, c.x, c.y, c.size*3);
      g.addColorStop(0, c.color);
      g.addColorStop(1, 'rgba(255,255,255,0)');
      sctx.fillStyle = g;
      sctx.arc(c.x, c.y, c.size*3, 0, Math.PI*2);
      sctx.fill();
      // age out
      if(c.life > 200 + Math.random()*200) state.creatures.splice(i,1);
    }
  }
  requestAnimationFrame(simTick);
}
simTick();

q('#clearSim').addEventListener('click', ()=>{
  state.creatures = []; updateCount();
  sctx.clearRect(0,0,simW,simH);
});
q('#toggleTrails').addEventListener('click', ()=>{
  state.trails = !state.trails;
  q('#toggleTrails').innerText = state.trails ? 'íŠ¸ë ˆì¼ ì¼¬' : 'íŠ¸ë ˆì¼ ë”';
});
function updateCount(){ q('#creCount').innerText = state.creatures.length; }

/* -----------------------------
   Weather: open-meteo (no key), dynamic background
   ----------------------------- */
const weatherStatus = q('#weatherStatus');
const weatherDetail = q('#weatherDetail');
const bgIntensity = q('#bgIntensity');

function applyBackground(tempC, weatherCode){
  // choose color palette by temp and code
  // cold -> bluish, moderate -> green, hot -> warm orange/red, rainy -> darkened
  let top='#dff7e6', bottom='#bfeccb';
  if(tempC <= 0){ top = '#dff4ff'; bottom = '#cfefff'; }
  else if(tempC <= 10){ top = '#e6f8e8'; bottom = '#d4f0d9'; }
  else if(tempC <= 20){ top = '#dff7e6'; bottom = '#bfeccb'; }
  else if(tempC <= 30){ top = '#fff4e0'; bottom = '#ffd9b3'; }
  else { top = '#fff0f0'; bottom = '#ffd1c1'; }
  // if rainy (codes >= 61 per open-meteo), darken
  const rainyCodes = [51,53,55,61,63,65,80,81,82,95,96,99];
  if(rainyCodes.includes(weatherCode)) {
    top = shade(top, -8); bottom = shade(bottom, -10);
  }
  const strength = parseFloat(bgIntensity.value);
  document.body.style.background = `linear-gradient(180deg, ${mixColors('#ffffff',top,strength)}, ${mixColors('#ffffff',bottom,strength)})`;
}

/* helper: mix two hex colors by t (0..1) */
function mixColors(a,b,t){
  const pa = hexToRgb(a), pb = hexToRgb(b);
  const r = Math.round(pa.r*(1-t)+pb.r*t), g = Math.round(pa.g*(1-t)+pb.g*t), bl = Math.round(pa.b*(1-t)+pb.b*t);
  return `rgb(${r},${g},${bl})`;
}
function hexToRgb(hex){
  hex = hex.replace('#','');
  if(hex.length===3) hex = hex.split('').map(x=>x+x).join('');
  const num = parseInt(hex,16);
  return {r:(num>>16)&255, g:(num>>8)&255, b:num&255};
}
/* shade hex by percent (-100..100) */
function shade(hex,percent){
  const c = hexToRgb(hex);
  const t = percent < 0 ? 0 : 255;
  const p = Math.abs(percent)/100;
  const r = Math.round((t - c.r) * p) + c.r;
  const g = Math.round((t - c.g) * p) + c.g;
  const b = Math.round((t - c.b) * p) + c.b;
  return `rgb(${r},${g},${b})`;
}

/* fetch weather by geolocation */
function fetchWeather(lat,lon){
  weatherStatus.innerText = 'í˜„ì¬ ìœ„ì¹˜ë¡œ ë‚ ì”¨ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤â€¦';
  fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
    .then(r=>r.json())
    .then(d=>{
      const w = d.current_weather;
      state.weather = w;
      weatherStatus.innerText = `í˜„ì¬: ${w.temperature}Â°C | í’ì† ${w.windspeed} km/h | ì½”ë“œ ${w.weathercode}`;
      weatherDetail.innerHTML = `<div class="small">ë°ì´í„° ì¶œì²˜: open-meteo.com Â· ì¢Œí‘œ: ${lat.toFixed(3)}, ${lon.toFixed(3)}</div>`;
      applyBackground(w.temperature, w.weathercode);
    })
    .catch(err=>{
      weatherStatus.innerText = 'ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
    });
}

if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(pos=>{
    fetchWeather(pos.coords.latitude,pos.coords.longitude);
  }, err=>{
    weatherStatus.innerText = 'ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë°°ê²½ì„ ì¡°ì ˆí•˜ì„¸ìš”.';
  });
} else {
  weatherStatus.innerText = 'ë¸Œë¼ìš°ì €ì—ì„œ ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
}
bgIntensity.addEventListener('input', ()=>{
  if(state.weather) applyBackground(state.weather.temperature, state.weather.weathercode);
});

/* -----------------------------
   WebAudio: synthesized rain + birds
   - no external audio files (works offline)
   ----------------------------- */
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

/* rain: filtered noise node with adjustable intensity */
function createRainNode(level=0.4){
  const ctx = audioCtx;
  const bufferSize = 2*ctx.sampleRate;
  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++){
    data[i] = (Math.random()*2-1)*0.7;
  }
  const noise = ctx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;
  const lp = ctx.createBiquadFilter();
  lp.type = 'bandpass';
  lp.frequency.value = 1200;
  lp.Q.value = 0.8;

  const gain = ctx.createGain();
  gain.gain.value = level * 0.6;

  noise.connect(lp).connect(gain);
  return {noise, gain};
}

/* birds: scheduled chirps using oscillators */
function createBirds(level=0.4){
  const ctx = audioCtx;
  const master = ctx.createGain();
  master.gain.value = level * 0.7;
  function chirp(time){
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = 1200 + Math.random()*800;
    g.gain.value = 0;
    o.connect(g); g.connect(master);
    o.start(time);
    g.gain.linearRampToValueAtTime(0.9, time + 0.01);
    g.gain.exponentialRampToValueAtTime(0.001, time + 0.3 + Math.random()*0.6);
    o.stop(time + 0.6 + Math.random()*0.6);
  }
  // scheduler: returns stopper with start/stop control
  let running = false, timer=null;
  function start(){
    if(running) return; running=true;
    const loop = () => {
      const now = ctx.currentTime;
      // schedule a few chirps
      const count = 1 + Math.floor(Math.random()*3);
      for(let i=0;i<count;i++){
        chirp(now + Math.random()*2.5);
      }
      timer = setTimeout(loop, 2000 + Math.random()*4000);
    };
    loop();
  }
  function stop(){
    running=false; if(timer) clearTimeout(timer);
  }
  return {master, start, stop};
}

let audioState = {rainNode:null,birds:null,masterGain:null};

function startAudio(){
  ensureAudio();
  if(audioState.masterGain) return;
  const ctx = audioCtx;
  const master = ctx.createGain(); master.gain.value = parseFloat(q('#masterVol').value);
  master.connect(ctx.destination);
  // rain
  const rain = createRainNode(parseFloat(q('#rainLevel').value));
  rain.noise.connect(rain.gain);
  rain.gain.connect(master);
  rain.noise.start();
  // birds
  const birds = createBirds(parseFloat(q('#birdLevel').value));
  birds.master.connect(master);
  birds.start();

  audioState = {rainNode:rain, birds:birds, masterGain:master};
  state.audioOn = true;
  q('#soundToggle').innerText = 'ìì—°ìŒ ë„ê¸°';
}

function stopAudio(){
  if(!audioState.masterGain) return;
  try{
    audioState.rainNode.noise.stop();
  }catch(e){}
  audioState.birds.stop();
  audioState = {rainNode:null,birds:null,masterGain:null};
  state.audioOn = false;
  q('#soundToggle').innerText = 'ìì—°ìŒ ì¼œê¸°';
}
q('#soundToggle').addEventListener('click', async ()=>{
  if(!state.audioOn){
    await resumeAudioContextIfNeeded();
    startAudio();
  } else {
    stopAudio();
  }
});

async function resumeAudioContextIfNeeded(){
  ensureAudio();
  if(audioCtx.state === 'suspended'){
    try{ await audioCtx.resume(); } catch(e){}
  }
}

/* controls react to sliders */
q('#rainLevel').addEventListener('input', ()=>{
  const v=parseFloat(q('#rainLevel').value);
  if(audioState.rainNode) audioState.rainNode.gain.gain.value = v*0.6;
});
q('#birdLevel').addEventListener('input', ()=>{
  const v=parseFloat(q('#birdLevel').value);
  if(audioState.birds) audioState.birds.master.gain.value = v*0.7;
});
q('#masterVol').addEventListener('input', ()=>{
  const v=parseFloat(q('#masterVol').value);
  if(audioState.masterGain) audioState.masterGain.gain.value = v;
});

/* -----------------------------
   Carbon footprint calculator
   - simple coefficients (illustrative)
     * electricity: 0.45 kgCO2e per kWh (example)
     * car: 0.21 kgCO2e per km (average small car)
     * diet factor multiplies baseline food emissions (example)
   ----------------------------- */
const inpElectric = q('#inpElectric'), valElectric = q('#valElectric');
const inpCar = q('#inpCar'), valCar = q('#valCar');
const dietSelect = q('#dietSelect');
const lastCarbon = q('#lastCarbon');

inpElectric.addEventListener('input', ()=> valElectric.innerText = inpElectric.value);
inpCar.addEventListener('input', ()=> valCar.innerText = inpCar.value);

function computeCarbonAnnual(){
  // monthly kWh to annual
  const monthlyKwh = Number(inpElectric.value);
  const annualKwh = monthlyKwh * 12;
  const elecFactor = 0.45; // kgCO2e per kWh (example)
  const elecKg = annualKwh * elecFactor;

  // car: weekly km -> annual km
  const weeklyKm = Number(inpCar.value);
  const annualKm = weeklyKm * 52;
  const carFactor = 0.21; // kgCO2e per km (example)
  const carKg = annualKm * carFactor;

  // food: baseline ~ 1500 kg/year * diet factor
  const dietFactor = Number(dietSelect.value);
  const foodKg = 1500 * dietFactor;

  const total = Math.round((elecKg + carKg + foodKg));
  return {elecKg:Math.round(elecKg), carKg:Math.round(carKg), foodKg:Math.round(foodKg), total};
}

let carbonChart = null;
function renderCarbonChart(data){
  const ctx = q('#carbonChart').getContext('2d');
  if(carbonChart) carbonChart.destroy();
  carbonChart = new Chart(ctx, {
    type:'doughnut',
    data:{
      labels:['ì „ê¸°','ìë™ì°¨','ì‹ë‹¨'],
      datasets:[{data:[data.elecKg, data.carKg, data.foodKg], backgroundColor:['#68d391','#38a169','#2f855a']}]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'bottom'}},
      animation:{duration:800}
    }
  });
}

q('#calcCarbon').addEventListener('click', ()=>{
  const res = computeCarbonAnnual();
  state.lastCarbonKg = res.total;
  q('#lastCarbon').innerText = res.total + ' kg COâ‚‚e/ë…„';
  renderCarbonChart(res);
});

q('#saveCarbon').addEventListener('click', ()=>{
  if(!state.lastCarbonKg) return alert('ë¨¼ì € ê³„ì‚°í•˜ì„¸ìš”');
  localStorage.setItem('eco_last_carbon', JSON.stringify({
    value: state.lastCarbonKg,
    timestamp: new Date().toISOString()
  }));
  alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

/* load saved */
(function loadSaved(){
  const s = localStorage.getItem('eco_last_carbon');
  if(s){ try{ const obj = JSON.parse(s); q('#lastCarbon').innerText = obj.value + ' kg COâ‚‚e/ë…„' }catch(e){} }
})();

/* -----------------------------
   Climate trend sample chart
   ----------------------------- */
const trendCtx = q('#trendChart').getContext('2d');
const trendChart = new Chart(trendCtx, {
  type:'line',
  data:{
    labels:['2000','2005','2010','2015','2020','2025'],
    datasets:[
      {label:'í‰ê· ê¸°ì˜¨ (ì˜ˆì‹œ: ì„œìš¸)', data:[12.5,12.8,13.1,13.7,14.0,14.3], borderColor:'#2f855a', tension:0.4, fill:false},
      {label:'í‰ê· ê¸°ì˜¨ (ì˜ˆì‹œ: ì„¸ê³„)', data:[12.0,12.1,12.4,12.6,12.9,13.2], borderColor:'#38a169', tension:0.35, fill:false}
    ]
  },
  options:{responsive:true, plugins:{legend:{position:'bottom'}}}
});

/* -----------------------------
   Quote & snapshot
   ----------------------------- */
const quotes = [
  "ìì—°ì€ ì¸ê°„ ì—†ì´ë„ ì¡´ì¬í•˜ì§€ë§Œ, ì¸ê°„ì€ ìì—° ì—†ì´ëŠ” ì¡´ì¬í•  ìˆ˜ ì—†ë‹¤. â€” ë°ì´ë¹„ë“œ ì• íŠ¼ë²„ëŸ¬",
  "ì§€êµ¬ë¥¼ ëŒë³´ëŠ” ê²ƒì€ ë¯¸ë˜ì—ê²Œ ë¹šì„ ê°šëŠ” ì¼ì´ë‹¤.",
  "ë‚˜ë¬´ í•œ ê·¸ë£¨ë¥¼ ì‹¬ëŠ” ê²ƒì€ í¬ë§ì„ ì‹¬ëŠ” ì¼ì´ë‹¤.",
  "ìš°ë¦¬ê°€ ë°”ê¾¸ëŠ” ì‘ì€ ìŠµê´€ì´ ì§€êµ¬ë¥¼ ì‚´ë¦°ë‹¤."
];
q('#newQuote').addEventListener('click', ()=> q('#quoteBlock').innerText = quotes[Math.floor(Math.random()*quotes.length)]);

/* snapshot: save canvas + stats as data URL in localStorage */
q('#shareSnapshot').addEventListener('click', ()=>{
  // combine simCanvas and trendChart (draw as images into an offscreen canvas)
  const off = document.createElement('canvas');
  off.width = Math.max(simCanvas.width, 800);
  off.height = 600;
  const octx = off.getContext('2d');
  // draw background gradient
  octx.fillStyle = window.getComputedStyle(document.body).backgroundImage;
  octx.fillRect(0,0,off.width,off.height);
  // draw sim snapshot
  octx.drawImage(simCanvas, 0, 0, off.width, off.height*0.5);
  // draw mini stats text
  octx.fillStyle = '#123';
  octx.font = '18px sans-serif';
  octx.fillText('ìƒëª…ì²´ ìˆ˜: ' + state.creatures.length, 16, off.height*0.52);
  octx.fillText('ìµœê·¼ íƒ„ì†Œ(ì €ì¥): ' + (localStorage.getItem('eco_last_carbon') ? JSON.parse(localStorage.getItem('eco_last_carbon')).value + ' kg' : 'â€”'), 16, off.height*0.55);
  // save dataURL
  const url = off.toDataURL('image/png');
  localStorage.setItem('eco_snapshot', url);
  alert('ìŠ¤ëƒ…ìƒ·ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ (ë¡œì»¬). "eco_snapshot" í‚¤ í™•ì¸ ê°€ëŠ¥.');
});

/* -----------------------------
   Reset
   ----------------------------- */
q('#resetApp').addEventListener('click', ()=>{
  if(!confirm('ì•± ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ì–´ìš”? (ë¡œì»¬ ì €ì¥ í¬í•¨)')) return;
  localStorage.removeItem('eco_last_carbon');
  localStorage.removeItem('eco_snapshot');
  q('#lastCarbon').innerText = 'â€”';
  stopAudio();
  state.creatures=[];
  sctx.clearRect(0,0,simW,simH);
  updateCount();
  alert('ì´ˆê¸°í™” ì™„ë£Œ');
});

/* -----------------------------
   Small UX polish: persist quote and initial startup
   ----------------------------- */
(function init(){
  const qSaved = localStorage.getItem('eco_quote');
  if(qSaved) q('#quoteBlock').innerText = qSaved;
  q('#newQuote').addEventListener('click', ()=> localStorage.setItem('eco_quote', q('#quoteBlock').innerText));
  // preload a few creatures
  for(let i=0;i<12;i++) spawnCreature(Math.random()*simW, Math.random()*simH*0.7);
  // if ambient auto start on touch (mobile), defer audio unlock to first user gesture
  document.body.addEventListener('touchstart', resumeAudioContextIfNeeded, {once:true});
})();
</script>
</body>
</html>
